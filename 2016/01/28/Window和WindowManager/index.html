<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Window和WindowManager | TigerFace</title>
  <meta name="author" content="TigerFace">
  
  <meta name="description" content="bugly也写了一篇更详细的浅析Android的窗口windowmanager 使用 demo1234567891011121314WindowManager mWindowManager = (WindowManager) getSystemService(Context.WINDOW_SERVICE);           Button mFloatingButton = new Button(this);           mFloatingButton.setText(&quot;click me&quot;);           WindowManager.LayoutParams  mLayoutParams = new WindowManager.LayoutParams(                   LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT, 0, 0,                   PixelFormat.TRANSPARENT);           mLayoutParams.flags = LayoutParams.FLAG_NOT_TOUCH_MODAL                   | LayoutParams.FLAG_NOT_FOCUSABLE                   | LayoutParams.FLAG_SHOW_WHEN_LOCKED;           mLayoutParams.type = LayoutParams.TYPE_SYSTEM_ERROR;           mLayoutParams.gravity = Gravity.LEFT | Gravity.TOP;           mLayoutParams.x = 100;           mLayoutParams.y = 300;               mWindowManager.addView(mFloatingButton, mLayoutParams);
注意：小米等手机进行了framework的修改，所以不能正常显示悬浮窗，需要自己去设置中心里面设置允许弹窗。">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Window和WindowManager"/>
  <meta property="og:site_name" content="TigerFace"/>

  
    <meta property="og:image" content="undefined"/>
  


  <link href="/favicon.ico" rel="icon" type="image/x-ico">
  <link rel="alternate" href="/atom.xml" title="TigerFace" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">TigerFace</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-01-28T10:46:47.000Z"><a href="/2016/01/28/Window和WindowManager/">2016-01-28</a></time>
      
      
  
    <h1 class="title">Window和WindowManager</h1>
  

    </header>
    <div class="entry">
      
        <p>bugly也写了一篇更详细的<br><a href="http://bugly.qq.com/bbs/forum.php?mod=viewthread&amp;tid=555&amp;fromuid=6" target="_blank" rel="external">浅析Android的窗口</a><br>windowmanager 使用 demo<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">WindowManager mWindowManager = (WindowManager) getSystemService(Context.WINDOW_SERVICE)<span class="comment">;</span></span><br><span class="line">           Button mFloatingButton = new Button(this)<span class="comment">;</span></span><br><span class="line">           mFloatingButton.setText("click me")<span class="comment">;</span></span><br><span class="line">           WindowManager.LayoutParams  mLayoutParams = new WindowManager.LayoutParams(</span><br><span class="line">                   LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT, 0, 0,</span><br><span class="line">                   PixelFormat.TRANSPARENT)<span class="comment">;</span></span><br><span class="line">           mLayoutParams.flags = LayoutParams.FLAG_NOT_TOUCH_MODAL</span><br><span class="line">                   | LayoutParams.FLAG_NOT_FOCUSABLE</span><br><span class="line">                   | LayoutParams.FLAG_SHOW_WHEN_LOCKED<span class="comment">;</span></span><br><span class="line">           mLayoutParams.type = LayoutParams.TYPE_SYSTEM_ERROR<span class="comment">;</span></span><br><span class="line">           mLayoutParams.gravity = Gravity.LEFT | Gravity.TOP<span class="comment">;</span></span><br><span class="line">           mLayoutParams.x = 100<span class="comment">;</span></span><br><span class="line">           mLayoutParams.y = 300<span class="comment">;    </span></span><br><span class="line">           mWindowManager.addView(mFloatingButton, mLayoutParams)<span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>注意：小米等手机进行了framework的修改，所以不能正常显示悬浮窗，需要自己去设置中心里面设置允许弹窗。<br><a id="more"></a></p>
<h1 id="u4E00_u3001WindowManager-LayoutParams_u7684flag"><a href="#u4E00_u3001WindowManager-LayoutParams_u7684flag" class="headerlink" title="一、WindowManager.LayoutParams的flag"></a>一、WindowManager.LayoutParams的flag</h1><p>Flags参数表示window的属性，通过这些选项可以控制Window的显示特性</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">/** <span class="type">Window</span> flag: this window won't ever get key input focus, so the</span><br><span class="line">         * user can <span class="keyword">not</span> send key <span class="keyword">or</span> other button events to it.  <span class="type">Those</span> will</span><br><span class="line">         * instead go to whatever focusable window <span class="keyword">is</span> behind it.  <span class="type">This</span> flag</span><br><span class="line">         * will also enable &#123;@link <span class="comment">#FLAG_NOT_TOUCH_MODAL&#125; whether or not that</span></span><br><span class="line">         * <span class="keyword">is</span> explicitly <span class="type">set</span>.</span><br><span class="line">         * </span><br><span class="line">         * &lt;p&gt;<span class="type">Setting</span> this flag also implies that the window will <span class="keyword">not</span> need to</span><br><span class="line">         * interact <span class="keyword">with</span></span><br><span class="line">         * a soft input <span class="keyword">method</span>, so it will be Z-ordered <span class="keyword">and</span> positioned </span><br><span class="line">         * independently <span class="keyword">of</span> <span class="type">any</span> active input <span class="keyword">method</span> (typically this means it</span><br><span class="line">         * gets Z-ordered on top <span class="keyword">of</span> the input <span class="keyword">method</span>, so it can use the full</span><br><span class="line">         * screen <span class="keyword">for</span> its content <span class="keyword">and</span> cover the input <span class="keyword">method</span> <span class="keyword">if</span> needed.  <span class="type">You</span></span><br><span class="line">         * can use &#123;@link <span class="comment">#FLAG_ALT_FOCUSABLE_IM&#125; to modify this behavior. */</span></span><br><span class="line"> public <span class="keyword">static</span> final <span class="type">int</span> <span class="type">FLAG_NOT_FOCUSABLE</span>      = <span class="number">0x00000008</span>;</span><br><span class="line"></span><br><span class="line">/** <span class="type">Window</span> flag: even <span class="keyword">when</span> this window <span class="keyword">is</span> focusable (its</span><br><span class="line">         * &#123;@link <span class="comment">#FLAG_NOT_FOCUSABLE&#125; is not set), allow any pointer events</span></span><br><span class="line">         * outside <span class="keyword">of</span> the window to be sent to the windows behind it.  <span class="type">Otherwise</span></span><br><span class="line">         * it will consume all <span class="type">pointer</span> events itself, regardless <span class="keyword">of</span> whether they</span><br><span class="line">         * are inside <span class="keyword">of</span> the window. */     </span><br><span class="line"></span><br><span class="line"> public <span class="keyword">static</span> final <span class="type">int</span> <span class="type">FLAG_NOT_TOUCH_MODAL</span>    = <span class="number">0x00000020</span>;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">/** <span class="type">Window</span> flag: special flag to <span class="keyword">let</span> windows be shown <span class="keyword">when</span> the screen</span><br><span class="line">         * <span class="keyword">is</span> locked. <span class="type">This</span> will <span class="keyword">let</span> application windows take precedence over</span><br><span class="line">         * key guard <span class="keyword">or</span> <span class="type">any</span> other lock screens. <span class="type">Can</span> be used <span class="keyword">with</span></span><br><span class="line">         * &#123;@link <span class="comment">#FLAG_KEEP_SCREEN_ON&#125; to turn screen on and display windows</span></span><br><span class="line">         * directly before showing the key guard window.  <span class="type">Can</span> be used <span class="keyword">with</span></span><br><span class="line">         * &#123;@link <span class="comment">#FLAG_DISMISS_KEYGUARD&#125; to automatically fully dismisss</span></span><br><span class="line">         * non-secure keyguards.  <span class="type">This</span> flag only applies to the top-most</span><br><span class="line">         * full-screen window.</span><br><span class="line">         */</span><br><span class="line"> public <span class="keyword">static</span> final <span class="type">int</span> <span class="type">FLAG_SHOW_WHEN_LOCKED</span> = <span class="number">0x00080000</span>;</span><br><span class="line"> //window会显示在锁屏界面（但测试发现，并没有）</span><br></pre></td></tr></table></figure>
<h1 id="u4E8C_u3001WindowManager-LayoutParams_u7684type"><a href="#u4E8C_u3001WindowManager-LayoutParams_u7684type" class="headerlink" title="二、WindowManager.LayoutParams的type"></a>二、WindowManager.LayoutParams的type</h1><p>Type 表示Window的类型。有3种类型。</p>
<ul>
<li>应用Window。z-index 1-99</li>
<li>子Window。不能单独存在，需要附属在父Window上。比如PopupWindow(TYPE_APPLICATION_PANEL),Dialog(查看源代码)。z-index 1000-1999</li>
<li>系统Window。Toast和状态栏等。z-index 2000-2999<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * Start of types of sub-windows.  The &#123;<span class="doctag">@link</span> #token&#125; of these windows</span><br><span class="line"> * must be set to the window they are attached to.  These types of</span><br><span class="line"> * windows are kept next to their attached window in Z-order, and their</span><br><span class="line"> * coordinate space is relative to their attached window.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FIRST_SUB_WINDOW = <span class="number">1000</span>;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Window type: a panel on top of an application window.  These windows</span><br><span class="line"> * appear on top of their attached window.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_APPLICATION_PANEL = FIRST_SUB_WINDOW;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Start of system-specific window types.  These are not normally</span><br><span class="line"> * created by applications.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FIRST_SYSTEM_WINDOW     = <span class="number">2000</span>;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Window type: the status bar.  There can be only one status bar</span><br><span class="line"> * window; it is placed at the top of the screen, and all other</span><br><span class="line"> * windows are shifted down so they are below it.</span><br><span class="line"> * In multiuser systems shows on all users' windows.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_STATUS_BAR         = FIRST_SYSTEM_WINDOW;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Window type: transient notifications.</span><br><span class="line"> * In multiuser systems shows only on the owning user's window.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_TOAST              = FIRST_SYSTEM_WINDOW+<span class="number">5</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>z-index越大，显示越在前面。有些type需要声明权限后使用。<br>利用type可以做悬浮窗，之前UC 浏览器出来的弹窗被广大安卓爱好者反编译研究。</p>
<p><a href="http://www.liaohuqiu.net/cn/posts/android-windows-manager/" target="_blank" rel="external">秋百万对悬浮窗的总结</a><br><a href="http://www.jianshu.com/p/167fd5f47d5c" target="_blank" rel="external">Android无需权限显示悬浮窗, 兼谈逆向分析app</a></p>
<h1 id="u4E09_u3001WindowManager_u7C7B_u5173_u7CFB_u56FE"><a href="#u4E09_u3001WindowManager_u7C7B_u5173_u7CFB_u56FE" class="headerlink" title="三、WindowManager类关系图"></a>三、WindowManager类关系图</h1><p><img src="http://img.blog.csdn.net/20150605171231242" alt=""><br>WindowManage继承自ViewManager，分别处理添加、删除、更新view的操作。WindowManager操作的都是View，而实际上Window是一个抽象的概念，是以View的形式存在的。View变化，与之对应的Window也会随之变化。如下面的代码，通过给View设置OnClickListener，改变LayoutParams.x,y就可以改变Window的位置。<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@<span class="function">Override</span><br><span class="line">    <span class="keyword">public</span> boolean <span class="title">onTouch</span>(<span class="params">View v, MotionEvent <span class="keyword">event</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> rawX = (<span class="keyword">int</span>) <span class="keyword">event</span>.getRawX();</span><br><span class="line">        <span class="keyword">int</span> rawY = (<span class="keyword">int</span>) <span class="keyword">event</span>.getRawY();</span><br><span class="line">        <span class="keyword">switch</span> (<span class="keyword">event</span>.getAction()) &#123;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_DOWN: &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_MOVE: &#123;</span><br><span class="line">            <span class="keyword">int</span> x = (<span class="keyword">int</span>) <span class="keyword">event</span>.getX();</span><br><span class="line">            <span class="keyword">int</span> y = (<span class="keyword">int</span>) <span class="keyword">event</span>.getY();</span><br><span class="line">            mLayoutParams.x = rawX;</span><br><span class="line">            mLayoutParams.y = rawY;</span><br><span class="line">            mWindowManager.updateViewLayout(mFloatingButton, mLayoutParams);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_UP: &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="u56DB_u3001_u8BE6_u89E3Window"><a href="#u56DB_u3001_u8BE6_u89E3Window" class="headerlink" title="四、详解Window"></a>四、详解Window</h1><p>Window是抽象类，从[Android是怎么加载布局的？]中我们发现PhoneWindow是Window的实例，而这个PhoneWindow是在com.android.internal.policy.impl包中，我们无法直接使用，只能是通过WindowManager来访问。</p>
<h2 id="window_u7684_u6DFB_u52A0"><a href="#window_u7684_u6DFB_u52A0" class="headerlink" title="window的添加"></a>window的添加</h2><p>需要使用WindowManager的addView来实现，WindowManagerImpl实现了WindowManager.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">    Provides low-level communication with the system window manager for operations that are bound to a particular context, display or parent window. Instances of this object are sensitive to the compatibility info associated with the running application. This object implements the ViewManager interface, allowing you to add any View subclass as a top-level window on the screen. Additional window manager specific layout parameters are defined for control over how windows are displayed. It also implements the WindowManager interface, allowing you to control the displays attached to the device. </span><br><span class="line">    Applications will not normally use WindowManager directly, instead relying on the higher-level facilities in android.app.Activity and android.app.Dialog. </span><br><span class="line"></span><br><span class="line">    Even for low-level window manager access, it is almost never correct to use this class. For example, android.app.Activity.getWindowManager() provides a window manager for adding windows that are associated with that activity -- the window manager will not normally allow you to add arbitrary windows that are not associated with an activity.</span><br><span class="line">*/</span>*</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowManagerImpl</span> <span class="keyword">implements</span> <span class="title">WindowManager</span> &#123;</span></span><br><span class="line"></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> WindowManagerGlobal mGlobal = WindowManagerGlobal.getInstance();</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> Display mDisplay;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> Window mParentWindow;</span><br><span class="line">     <span class="comment">//省略n行代码。。</span></span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line">     <span class="keyword">public</span> <span class="typename">void</span> addView(<span class="annotation">@NonNull</span> View view, <span class="annotation">@NonNull</span> ViewGroup.LayoutParams params) &#123;</span><br><span class="line">         applyDefaultToken(params);</span><br><span class="line">         mGlobal.addView(view, params, mDisplay, mParentWindow);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<p>WindowManagerGlobal.java</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;View&gt; mViews = <span class="keyword">new</span> ArrayList&lt;View&gt;();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;ViewRootImpl&gt; mRoots = <span class="keyword">new</span> ArrayList&lt;ViewRootImpl&gt;();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;WindowManager.LayoutParams&gt; mParams =</span><br><span class="line">            <span class="keyword">new</span> ArrayList&lt;WindowManager.LayoutParams&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> addView(View view, ViewGroup.LayoutParams params,</span><br><span class="line">            Display display, Window parentWindow) &#123;</span><br><span class="line">        <span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"view must not be null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (display == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"display must not be null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!(params <span class="keyword">instanceof</span> WindowManager.LayoutParams)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Params must be WindowManager.LayoutParams"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> WindowManager.LayoutParams wparams = (WindowManager.LayoutParams)params;</span><br><span class="line">        <span class="keyword">if</span> (parentWindow != <span class="keyword">null</span>) &#123;</span><br><span class="line">            parentWindow.adjustLayoutParamsForSubWindow(wparams);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// If there's no parent and we're running on L or above (or in the</span></span><br><span class="line">            <span class="comment">// system context), assume we want hardware acceleration.</span></span><br><span class="line">            <span class="keyword">final</span> Context context = view.getContext();</span><br><span class="line">            <span class="keyword">if</span> (context != <span class="keyword">null</span></span><br><span class="line">                    &amp;&amp; context.getApplicationInfo().targetSdkVersion &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">                wparams.flags |= WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ViewRootImpl root;</span><br><span class="line">        View panelParentView = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">            <span class="comment">// Start watching for system property changes.</span></span><br><span class="line">            <span class="keyword">if</span> (mSystemPropertyUpdater == <span class="keyword">null</span>) &#123;</span><br><span class="line">                mSystemPropertyUpdater = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    @Override <span class="keyword">public</span> <span class="keyword">void</span> run() &#123;</span><br><span class="line">                        <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">                            <span class="keyword">for</span> (<span class="built_in">int</span> i = mRoots.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">                                mRoots.<span class="built_in">get</span>(i).loadSystemProperties();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">                SystemProperties.addChangeCallback(mSystemPropertyUpdater);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">int</span> index = findViewLocked(view, <span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mDyingViews.contains(view)) &#123;</span><br><span class="line">                    <span class="comment">// Don't wait for MSG_DIE to make it's way through root's queue.</span></span><br><span class="line">                    mRoots.<span class="built_in">get</span>(index).doDie();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"View "</span> + view</span><br><span class="line">                            + <span class="string">" has already been added to the window manager."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// The previous removeView() had not completed executing. Now it has.</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// If this is a panel window, then find the window it is being</span></span><br><span class="line">            <span class="comment">// attached to for future reference.</span></span><br><span class="line">            <span class="keyword">if</span> (wparams.type &gt;= WindowManager.LayoutParams.FIRST_SUB_WINDOW &amp;&amp;</span><br><span class="line">                    wparams.type &lt;= WindowManager.LayoutParams.LAST_SUB_WINDOW) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="built_in">int</span> count = mViews.<span class="built_in">size</span>();</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (mRoots.<span class="built_in">get</span>(i).mWindow.asBinder() == wparams.token) &#123;</span><br><span class="line">                        panelParentView = mViews.<span class="built_in">get</span>(i);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            root = <span class="keyword">new</span> ViewRootImpl(view.getContext(), display);</span><br><span class="line"></span><br><span class="line">            view.setLayoutParams(wparams);</span><br><span class="line"></span><br><span class="line">            mViews.<span class="built_in">add</span>(view);</span><br><span class="line">            mRoots.<span class="built_in">add</span>(root);</span><br><span class="line">            mParams.<span class="built_in">add</span>(wparams);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// do this last because it fires off messages to start doing things</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            root.setView(view, wparams, panelParentView);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">            <span class="comment">// BadTokenException or InvalidDisplayException, clean up.</span></span><br><span class="line">            <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="built_in">int</span> index = findViewLocked(view, <span class="keyword">false</span>);</span><br><span class="line">                <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    removeViewLocked(index, <span class="keyword">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>根据代码，WindowManagerGlobal.addView()主要分以下几步：<br>1、检查参数是否合法<br>2、创建ViewRootImpl，并将View添加到列表mRoots中；view添加到mViews中；param添加到mParams中。<br>3、通过root.setView来完成Window的添加过程。ViewRootImpl的setView方法会触发requestLayout，然后就是喜闻乐见的view绘制过程了。接下来通过windowSession完成window的添加过程。最终交给WMS来处理。<br>ViewRootImpl.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setView</span><span class="params">(View view, WindowManager.LayoutParams attrs, View panelParentView)</span> </span>&#123;</span><br><span class="line"><span class="comment">//省略n多代码</span></span><br><span class="line"><span class="comment">// Schedule the first layout -before- adding to the window</span></span><br><span class="line"><span class="comment">// manager, to make sure we do the relayout before receiving</span></span><br><span class="line"><span class="comment">// any other events from the system.</span></span><br><span class="line">requestLayout();</span><br><span class="line"><span class="keyword">if</span> ((mWindowAttributes.inputFeatures</span><br><span class="line">        &amp; WindowManager.LayoutParams.INPUT_FEATURE_NO_INPUT_CHANNEL) == <span class="number">0</span>) &#123;</span><br><span class="line">    mInputChannel = <span class="keyword">new</span> InputChannel();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">                    mOrigWindowType = mWindowAttributes.type;</span><br><span class="line">                    mAttachInfo.mRecomputeGlobalAttributes = <span class="keyword">true</span>;</span><br><span class="line">                    collectViewAttributes();</span><br><span class="line">                    res = mWindowSession.addToDisplay(mWindow, mSeq, mWindowAttributes,</span><br><span class="line">                            getHostVisibility(), mDisplay.getDisplayId(),</span><br><span class="line">                            mAttachInfo.mContentInsets, mAttachInfo.mStableInsets, mInputChannel);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">                    mAdded = <span class="keyword">false</span>;</span><br><span class="line">                    mView = <span class="keyword">null</span>;</span><br><span class="line">                    mAttachInfo.mRootView = <span class="keyword">null</span>;</span><br><span class="line">                    mInputChannel = <span class="keyword">null</span>;</span><br><span class="line">                    mFallbackEventHandler.setView(<span class="keyword">null</span>);</span><br><span class="line">                    unscheduleTraversals();</span><br><span class="line">                    setAccessibilityFocus(<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Adding window failed"</span>, e);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (restore) &#123;</span><br><span class="line">                        attrs.restore();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">requestLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!mHandlingLayoutInLayoutRequest) &#123;</span><br><span class="line">            checkThread();</span><br><span class="line">            mLayoutRequested = <span class="keyword">true</span>;</span><br><span class="line">            scheduleTraversals();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="window_u7684_u5220_u9664_u548C_u66F4_u65B0"><a href="#window_u7684_u5220_u9664_u548C_u66F4_u65B0" class="headerlink" title="window的删除和更新"></a>window的删除和更新</h2><p>这个就没啥好说的了。跟上面太类似了。删除通过VIewRootImpl来完成删除操作，进行垃圾回收等等。通过WMS删除window；回调Window的onDetachedFromWindow等等。更新就是重新设置LayoutParam，ViewRootImpl通过schedualTraversals对View进行重绘。结合Android源码和开发艺术探索第8章去看吧。</p>
<h1 id="u4E94_u3001Window_u7684_u521B_u5EFA_u8FC7_u7A0B"><a href="#u4E94_u3001Window_u7684_u521B_u5EFA_u8FC7_u7A0B" class="headerlink" title="五、Window的创建过程"></a>五、Window的创建过程</h1><p>View是Android中视图的呈现方式，但View是附着在Window这个抽象上面，因此有视图的地方就有window，比如Activity、Dialog、Toast、Popupwindow等。<br>其实在<a href="http://tigerface.github.io/2016/01/27/Android是怎么加载布局的？/">Android是怎么加载布局的？</a>中已经描述了window的创建过程，就是那个PhoneWindow。。<br>简单描述Activity启动过程：</p>
<ul>
<li><p>1、ActivityThread.performLaunchActivity<br>ActivityThread.java</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123;</span><br><span class="line"><span class="attribute">...</span></span><br><span class="line">activity<span class="built_in">.</span>attach(<span class="attribute">...</span>)</span><br><span class="line"></span><br><span class="line"><span class="attribute">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2、创建Window，设置回调<br>PhoneWindow</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> attach(Context context, ActivityThread aThread,</span><br><span class="line">           Instrumentation instr, IBinder token, <span class="built_in">int</span> ident,</span><br><span class="line">           Application application, Intent intent, ActivityInfo info,</span><br><span class="line">           CharSequence title, Activity parent, <span class="built_in">String</span> id,</span><br><span class="line">           NonConfigurationInstances lastNonConfigurationInstances,</span><br><span class="line">           Configuration config, <span class="built_in">String</span> referrer, IVoiceInteractor voiceInteractor) &#123;</span><br><span class="line">       attachBaseContext(context);</span><br><span class="line">       mFragments.attachActivity(<span class="keyword">this</span>, mContainer, <span class="keyword">null</span>);</span><br><span class="line">       mWindow = PolicyManager.makeNewWindow(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>3、当Activity的setContentView被调用时，就会创建Decor等。</p>
</li>
<li>最后Activity组件创建完成之后，通过调用ActivityThread类的handleResumeActivity将它激活。进而调用Activity的makeVisible方法显示控件。<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">void makeVisible<span class="literal">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mWindowAdded) &#123;</span><br><span class="line">            <span class="type">ViewManager</span> wm = getWindowManager<span class="literal">()</span>;</span><br><span class="line">            wm.addView(mDecor, getWindow<span class="literal">()</span>.getAttributes<span class="literal">()</span>);</span><br><span class="line">            mWindowAdded = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mDecor.setVisibility(<span class="type">View</span>.<span class="type">VISIBLE</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>参考资料：<br><a href="http://baike.baidu.com/link?url=PuXKssdVFDESqPFMdAHflsUiiuO3HeisRHl2g_Ch69LfrLs904dci8Epe0RK58IIzrS8GO8dwF-Iw0o67lmgbYYiWsghgZVJjHRBKI1rq3g-DIpnqHkEKtXnSjXtpfBF78Iny6LoctyKWfeaizvJuK" target="_blank" rel="external">开发艺术探索：第8章</a><br><a href="http://blog.csdn.net/yanbober/article/details/46361191" target="_blank" rel="external">Android应用Activity、Dialog、PopWindow、Toast窗口添加机制及源码分析</a></p>

      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/tags/android/">android</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




<nav id="pagination" >
    
    <a href="/2016/02/01/android-async-http解析和使用/" class="alignleft prev" >上一页</a>
    
    
    <a href="/2016/01/28/详解LayoutInfalter-inflate/" class="alignright next" >下一页</a>
    
    <div class="clearfix"></div>
</nav>

<!-- 多说评论框 start -->
 <div class="ds-thread" data-thread-key="/2016/01/28/Window和WindowManager/" data-title="Window和WindowManager" data-url="http://tigerface.github.io/2016/01/28/Window和WindowManager/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"tigerface"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共JS代码 end -->
<section id="comment">
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:tigerface.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/技术/">技术</a><small>3</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/android/" style="font-size: 20px;">android</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/工具/" style="font-size: 10px;">工具</a> <a href="/tags/框架/" style="font-size: 10px;">框架</a> <a href="/tags/疑难杂症/" style="font-size: 10px;">疑难杂症</a>
  </div>
</div>


  <div class="widget tag">
<h3 class="title">友情链接</h3>
	<ul class="entry">
	<li><a href="http://104.236.134.90/"       				target=_blank title="">华仔的网站</a></li>	
	<li><a href="http://www.github.com/tigerface"   target=_blank title="我的GitHub">我的GitHub</a></li>
	<li><a href="http://www.weibo.com/mydistiny"    target=_blank title="">我的微博</a></li>
	<li><a href="http://www.liaoxuefeng.com/"       target=_blank title="git和python教程">廖雪峰</a></li>
	<li><a href="http://blog.csdn.net/lmj623565791" target=_blank title="">鸿洋csdn</a></li>
	<li><a href="http://www.liaohuqiu.net"          target=_blank title="土豪Android开发">秋百万</a></li>
	<li><a href="http://www.trinea.cn"              target=_blank title="trinea"></a></li>
	<li><a href="http://zmywly8866.github.io"       target=_blank title="">张明云的博客</a></li>
	<li><a href="http://hukai.me"                   target=_blank title="胡凯"胡凯></a></li>
	<li><a href="http://drakeet.me"                 target=_blank title="">drakeet</a></li>
	<li><a href="http://blog.csdn.net/yanbober/article/category/3206943/2"       target=_blank title="">工匠若水</a></li>
	<li><a href="url: http://droidyue.com"          target=_blank title="">技术小黑屋</a></li>
	<li><a href="http://toutiao.io"                 target=_blank title="">开发者头条</a></li>
	<li><a href="http://www.androidweekly.cn"       target=_blank title="">Androidweekly</a></li>
	<li><a href="http://www.devtf.cn"       		target=_blank title="">开发技术前线</a></li>
	<li><a href="http://www.jcodecraeer.com/plus/list.php?tid=16"       				target=_blank title="">泡在网上的日子</a></li>	
	<li><a href="http://gank.io"       				target=_blank title="">gank.io</a></li>	
	<li><a href="https://github.com/android-cn/android-dev-cn"       				target=_blank title="">android-dev-cn</a></li>
		
</ul>
</div>

  <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=5&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=2171653847&verifier=893152b7&dpc=1"></iframe>
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2016 TigerFace
  
</div>
<div class="clearfix"></div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
</footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>

<a href="https://github.com/tigerface"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/82b228a3648bf44fc1163ef44c62fcc60081495e/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png"></a>